# Power Sun - firmware

## Animation parameters

TODO: The PWR signal pulses with 1 Hz 50% duty cycle during system standby. The Power Sun should NOT follow this cycle with full power on brightness!
32 Hz animation rate.
8 seconds delay buffer.

Live parameters derived from inputs:
- PWR input: ON or OFF state
- HDD input: Pulse intensity value (8 bit?) generated by RC charge simulation from binary input

Parameters
- master brightness rings (8 bit)
- master brightness stripes (8 bit)
- power-on peak brightness
- power-on propagation delay
- power-on time constant
- idle brightness
- hdd maximum brightness
- hdd time constant
- propagation delay
- power-off time constant
- power-off propagation delay

## Animation description
The central LED ring essentially runs the animation and the other rings just follow successively with
a fixed delay between each ring. The 6th channel which controls the LED stripes on the edges of the PC
case acts as the outer ring but has a separate maximum brightness.
 
### PWR transition OFF -> ON
Fade to power-on peak brightness using special time constant and propagation delay.
As soon as power-on peak brightness is reached, HDD dependent fading commences.

### HDD HIGH
Regualrly calls some charge function on the animation which causes the LEDs to RC style "charge" until
hdd maximum brightness is reached.

### HDD HIGH
Regualrly calls some discharge function on the animation which causes the LEDs to RC style "discharge" until
idle brightness is reached.

### PWR transition OFF -> ON
Fade to off using special time constant and propagation delay.

## configuration interface
Uses virtual COM port via USB full speed.
- As soon as a host opens the USB CDC, the animation is stopped and the configuration CLI is presented.
- The CLI contains trigger for the purpose of testing different settings which start specific actions on the animation.
- All parameters mentioned above can be configured by this CLI.
- Closing the USB CDC stores all settings to Flash memory if they were changed and restarts normal operation.

## Notes
- Maximum timer resolution for 1kHz PWM frequency: 48000
- Gamma correction with LUT provided by [victornpb.github.io/gamma-table-generator](https://victornpb.github.io/gamma-table-generator)
 
